machine:
  node:
    version: 4.1.0
dependencies:
  pre:
    - sudo apt-get update; sudo apt-get install makeself p7zip-full;
    - npm install -g istanbul
deployment:
  staging:
    branch: /(feature|fix|chore).*/
    commands:
      - rm -rf node_modules
      - npm install --production
      - npm install electron-packager
      - cd java-network-test && mvn package
      - cp java-network-test/target/javanetworktest-1.0-SNAPSHOT-jar-with-dependencies.jar ./java-network-test.jar
      - node build.js
      - cp builds/*.exe $CIRCLE_ARTIFACTS
      - cp builds/*.sh $CIRCLE_ARTIFACTS
      - cp builds/*.tar.gz $CIRCLE_ARTIFACTS

  production:
    branch: master
    commands:
      - rm -rf node_modules
      - npm install --production
      - npm install electron-packager
      - cd java-network-test && mvn package
      - cp java-network-test/target/javanetworktest-1.0-SNAPSHOT-jar-with-dependencies.jar ./java-network-test.jar
      - node -e 'var d = new Date();console.log("\"" + d.getUTCFullYear() + "." + (d.getUTCMonth() + 1) + "." + d.getUTCDate() + "." + d.getUTCHours() + "." + d.getUTCMinutes() + "\"")' > version.json
      - node build.js
      - cp builds/*.exe $CIRCLE_ARTIFACTS
      - cp builds/*.sh $CIRCLE_ARTIFACTS
      - cp builds/*.tar.gz $CIRCLE_ARTIFACTS
      - node -e 'console.log("deploying version " + require("./version.json"))'

test:
  post:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - mkdir -p $CIRCLE_TEST_REPORTS/mocha/
    - find . -type f -regex ".*/target/surefire-reports/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;
    - cp test/test-results.xml $CIRCLE_TEST_REPORTS/mocha

#Upload installer executables at install-versions.risevision.com
#Update .cfg files with the new version number
#Upload .cfg files
